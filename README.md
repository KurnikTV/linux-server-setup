Что делает playbook?
1) Обновляет систему — обновляет и апгрейдит все пакеты до последних версий.
2) Создаёт пользователя с именем support, с домашней директорией, оболочкой bash и правами sudo.
3) Настраивает SSH-доступ:
 - Изменяет стандартный порт SSH на 40022 (или другой, заданный в переменной).
 - Отключает вход под root по SSH.
 - Отключает аутентификацию по паролю, разрешая только вход по ключу.
 - Добавляет указанный публичный SSH-ключ для нового пользователя.
 - Перезапускает SSH-сервис для применения изменений.
4) Устанавливает необходимые пакеты: wget, net-tools, fail2ban, iptables, iptables-persistent.
5) Настраивает файрвол с помощью iptables:
 - Сбрасывает все текущие правила.
 - Разрешает loopback-интерфейс и уже установленные соединения.
 - Разрешает доступ на порты SSH (по новому порту), HTTP (80) и HTTPS (443).
 - Блокирует все остальные входящие подключения.
 - Сохраняет и включает автоматический запуск правил iptables.
6) Настраивает Fail2Ban для защиты SSH:
 - Включает jail для SSH, который блокирует IP после 3 неудачных попыток входа на час.
 - Включает и запускает сервис fail2ban.
7) В случае обновления пакетов вызывает перезагрузку системы (если это необходимо).

Переменные:
 - `ssh_user` — имя создаваемого пользователя (по умолчанию support)
 - `ssh_port` — порт для SSH (по умолчанию 40022)
 - `ssh_pubkey` — путь к файлу публичного SSH-ключа, который будет добавлен в аккаунт пользователя
 - `allowed_ports` — список портов, которые будут разрешены в файрволе (SSH, 80, 443)

Использование автоматизации:
Требования:
 - Локальная машина с установленным Ansible
 - Вход на сервер под учетной записью root
 - Публичные SSH-ключи (./files/id_ed25519.pub) который будет исполь

Шаги применения:
- Клонируйте репозиторий или скопируйте директорию с playbook на вашу локальную машину:
```
git clone https://github.com/KurnikTV/linux-server-setup.git
cd linux-server-setup
```
- Проверьте и при необходимости отредактируйте переменные в playbook.yml:
`ssh_user` — имя нового пользователя (по умолчанию support)
`ssh_port` — новый SSH-порт (по умолчанию 40022)

- Путь к публичному ключу files/id_ed25519.pub

- Запустите playbook:
ansible-playbook playbook.yml

-Дождитесь выполнения playbook. В случае обновления пакетов сервер перезагрузится автоматически.

После успешного выполнения можно подключаться к серверу новым пользователем по SSH с использованием ключа на новом порту.

